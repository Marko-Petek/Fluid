% !TeX root = ./Lsfem.tex
\input{../../DocsPreamble.tex}

\fancyhead[L]{Marko Petek \\[0.3cm] }
\fancyhead[C]{\includegraphics[height=1.6cm]{Slike/logo-um-fnm}}
\fancyhead[R]{Maribor,\\ 13.\ VII.\ 2019 \\[0.15cm] }
\cfoot{\thepage}								      % Footer center = page number.			
\renewcommand{\headrulewidth}{0.0cm}			% Horizontal line in header. 0 = no horizontal line.
\renewcommand{\footrulewidth}{0.0cm}			% Horizontal line in footer

\begin{document}
   \begin{center}
      \textbf{\LARGE{Block Structured Mesh}}\\[0.25cm]
   \end{center}

\section*{BlockMesh.cs}
   Two 2nd rank tensors serve as storage for node variable values (node vars):
   \vspace{-7mm}
   \begin{IEEEeqnarray*}{llll}
      \hspace{13mm} & \hspace{15mm} & \hspace{30mm} &
      \\
      \mathbsf{u}_\triangleright &
      u_\triangleright^{j l} &
      \textsf{Tensor Uf} &
      \texttt{free node vars} \ ,
      \\
      \mathbsf{u}_\triangleleft &
      u_\triangleleft^{j l} &
      \textsf{Tensor Uc} &
      \texttt{constrained node vars} \ .
      \vspace{-1mm}
   \end{IEEEeqnarray*}
   where the slots represent:
   \vspace{-8mm}
   \begin{IEEEeqnarray*}{ccl}
       & \hspace{10mm} &  \\
      j & \rightarrow & N \texttt{ nodes, } \\
      l & \rightarrow & m \texttt{ variables. }
      \vspace{-1mm}
   \end{IEEEeqnarray*}
   The two tensors hold mutually exclusive information - if the component $u^{5, 4}$ appears in $\mathbsf{u}_\triangleright$, it cannot appear in $\mathbsf{u}_\triangleleft$ because a variable is either constrained or it isn't. The sum of them thus produces a tensor which holds all values:
   \begin{IEEEeqnarray*}{lcc}
      \mathbsf{u}_{\bowtie}
      =
      \mathbsf{u}_\triangleright + \mathbsf{u}_\triangleleft &
      \hspace{10mm} \textsf{double U}\hspace{10mm} &
         \texttt{all = free + constrained} \ .
   \end{IEEEeqnarray*}
   Here \textsf{U} is a method that can access values from both \textsf{Uf} and \textsf{Uc} - given an index, it retrieves the value from the correct source. A third 2nd rank tensor stores all forcing vars (right-hand side od \texttt{PDE}):
   \vspace{-6mm}
   \begin{IEEEeqnarray*}{llll}
      \hspace{20mm} & \hspace{20mm} & \hspace{30mm} &
      \\
      \mathbsf{f}_{\bowtie} & f_{\bowtie}^{jl} &
      \textsf{Tensor F} &
      \texttt{forcing vars .}
   \end{IEEEeqnarray*}
   The dynamic parameters (determining the system's evolution in the next step) are stored in a 4th rank tensor $\mathbsf{A}$, also known as the stiffness matrix:
   \vspace{-6mm}
   \begin{IEEEeqnarray*}{llll}
      \hspace{20mm} & \hspace{20mm} & \hspace{30mm} &
      \\
      \mathbsf{A} &
      A^{iphl} &
      \textsf{Tensor A} &
      \texttt{stiffness matrix ,}
      \vspace{-1mm}
   \end{IEEEeqnarray*}
   where the slots represent:
   \vspace{-7mm}
   \begin{IEEEeqnarray*}{ccl}
       & \hspace{10mm} &  \\
      i & \rightarrow & N \texttt{ nodes, } \\
      p & \rightarrow & 3 \texttt{ partials, } \\
      h & \rightarrow & m \texttt{ equations, } \\
      l & \rightarrow & m \texttt{ variables .}
   \end{IEEEeqnarray*}
   Dynamics must not depend on element shapes. This is properly accounted for
   
   \setlength{\textheight}{193mm}
   \pagebreak
   \setlength{\topmargin}{5mm}			% Header Top Margin Height
   \setlength{\headheight}{0.0cm}
   \setlength{\headsep}{5mm}			% Header Lower Margin Height	 Footer height
   \fancyhf{}
   \fancyfoot[C]{\thepage}
   
   with node-to-node influence weights in the form of overlap integrals. Triple overlap integrals reside in a 7th rank tensor $\mathbsf{S}$, while double overlap integrals reside in a 5th rank tensor $\mathbsf{T}$:
   \vspace{-5mm}
   \begin{IEEEeqnarray*}{llll}
      \hspace{15mm} & \hspace{25mm} & \hspace{25mm} &
      \\
      \mathbsf{S} &
      S_{\varepsilon \beta \alpha p \gamma \delta q} &
      \textsf{Tensor S} &
      \texttt{tripple overlap integrals ,}
      \\
      \mathbsf{T} &
      T_{\varepsilon \beta \alpha p \gamma} &
      \textsf{Tensor T} &
      \texttt{double overlap integrals ,}
   \end{IEEEeqnarray*}
   where the slots represent:
   \vspace{-7mm}
   \begin{IEEEeqnarray*}{ccl}
       & \hspace{10mm} &  \\
      \varepsilon & \rightarrow & n \texttt{ elements, } \\
      \beta & \rightarrow & 12 \texttt{ basis funcs of 1st } \mathbsf{A} \, , \\
      \alpha & \rightarrow & 12 \texttt{ basis funcs of } \mathbsf{v} \, , \\
      p & \rightarrow & 3 \texttt{ partials of } \mathbsf{v} \, , \\
      \gamma & \rightarrow & 12 \texttt{ basis funcs of } \mathbsf{u}_{\triangleleft} \texttt{ or } \mathbsf{f} \, , \\
      \delta & \rightarrow & 12 \texttt{ basis funcs of } \mathbsf{u}_{\triangleright} \, , \\
      q & \rightarrow & 3 \texttt{ partials of } \mathbsf{u}_{\triangleright} \, .
   \end{IEEEeqnarray*}
   In the assembly process we go over each element $\varepsilon$ and inside the element over all free nodes $i$ and $j$. Inside the element:
   \begin{IEEEeqnarray}{c}
      \forall \, v^{ik}_{\triangleright}: \quad
      \sum^N_{i,j} \mkern-2mu v^{i k}_{\triangleright}
      \sum^n_\varepsilon
      \mkern-7mu
      \sum_{\substack{\alpha, \delta \, \ni: \\ (\varepsilon,\alpha) = i \\ (\varepsilon,\delta) = j}}^{12}
      \mkern-10mu
      \qty(
      S_{\varepsilon \beta \alpha p \gamma \delta q} \mkern2mu
      A^{\substack{\mkern2mu \varepsilon \\[0.15mm] \beta} \mkern2mu p}_{\mkern19mu hk}    A^{\substack{\mkern2mu \varepsilon \\[-0.4mm] \gamma} \mkern2mu qhl} \mkern1mu     u^{\substack{\mkern2mu \varepsilon \\[0.2mm] \delta} \mkern2mu l}_\triangleright )
      = \\
      \sum^N_i v^{i k}_{\triangleright}
      \sum^n_\varepsilon
      \mkern-7mu
      \sum_{\substack{\alpha \, \ni: \\ (\varepsilon,\alpha) = i}}^{12}
      \mkern-10mu
      \qty(
      T_{\varepsilon \beta \alpha p \gamma}
      A^{\substack{\mkern2mu \varepsilon \\[0.15mm] \beta} \mkern2mu p}_{\mkern19mu hk}    f^{\substack{\mkern2mu \varepsilon \\[-0.4mm] \gamma} \mkern2mu h}_{\bowtie}
      -
      S_{\varepsilon \beta \alpha p \gamma \delta q}    A^{\substack{\mkern2mu \varepsilon \\[0.15mm] \beta} \mkern2mu p}_{\mkern19mu hk}    A^{\substack{\mkern2mu \varepsilon \\[-0.4mm] \gamma} \mkern2mu qhl}    u^{\substack{\mkern2mu \varepsilon \\[0.2mm] \delta} \mkern2mu l}_\triangleleft
      ) \IEEEnonumber
   \end{IEEEeqnarray}
   into this:
   \begin{equation*}
      K_{i k j l} \mkern1mu u^{j l}_\triangleright
      =
      F_{i k} \ .
   \end{equation*}

   The tensor $K_{ikjl}$ is symmetric over pairs of indices $(i,k)$ and $(j,l)$ because the integral between nodes $(i,j)$, for corresponding partials $(k,l)$, must be identical to the integral between nodes $(j,i)$, for corresponding partials $(l,k)$. Therefore, to avoid redundant work, we iterate on each element over node indices $\alpha$ and $\delta$ in the following way:

   \begin{longtable}{c|ccccccccccc}
      $\alpha$ & \hspace{6mm} & \hspace{6mm} & \hspace{6mm} & \hspace{6mm} & \hspace{6mm} & \hspace{1.3mm} $\delta$ \hspace{1.3mm} & \hspace{6mm} & \hspace{6mm} & \hspace{6mm} & \hspace{6mm} & \hspace{6mm} \\
      \hline
      1  &    &   &   &   &   &   &   &   &   &   & 0 \\
      2  &    &   &   &   &   &   &   &   &   & 1 & 0 \\
      3  &    &   &   &   &   &   &   &   & 2 & 1 & 0 \\
      \vdots&&  &   &   &   &\vdots&   &   &   &   &  \\
      10 &    & 9 & 8 & 7 & 6 & 5 & 4 & 3 & 2 & 1 & 0 \\
      11 & 10 & 9 & 8 & 7 & 6 & 5 & 4 & 3 & 2 & 1 & 0
   \end{longtable}
   
   while going through all $3 \times 3$ combinations of derivatives. We add the same value to the pair (i,j) and its symmetric pair (j,i). Then iterate over all repeated indices: (0,0), (1,1), ..., (10,10), (11,11) on the diagonal and add each value for all $3 \times 3$ combinations only once.

\end{document}